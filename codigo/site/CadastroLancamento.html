<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cadastro de Lançamentos</title>
    <link rel="stylesheet" href="css/styleLancamentos.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


    <body onload="init()" class="vsc-initialized">

        <div class="navbar">

            <a href="#">Home</a>

            <div class="dropdown">
                <button class="dropbtn">Perfil 
                    <i class="fa fa-caret-down"></i>
                  </button>
                <div class="dropdown-content">
                    <a href="#">Meu Perfil</a>
                    <a href="#">Alterar Perfil</a>
                </div>
            </div>

            <div class="dropdown">
                <button class="dropbtn">Gerenciar Cadastros 
                      <i class="fa fa-caret-down"></i>
                    </button>
                <div class="dropdown-content">
                    <a href="#">Categoria</a>
                    <a href="#">Contas</a>
                </div>
            </div>

            <a href="#">Lançamentos</a>
            <a href="#">Ações</a>
            <a href="#">Notícias</a>
            <div class="sair">
                <a href="#">Sair</>
            </div>

        </div>

        <form id="form-lancamento">
            <div class="row">
                <div class="column">
                    <div class="card">

                        <label for="inputId">ID</label>
                        <input type="text" class="form-control" id="inputId" placeholder="ID" disabled="">

                        <label for="inputContas">Conta</label>
                        <select name="inputConta" id="inputContas" class="form-controll" onChange="selectsConta()" required>
                            <option value="" disabled>Selecione uma Conta</option>  
                            <option value=""></option>
                        </select>

                        <label for="inputValor">Valor</label>
                        <input type="number" id="inputValor" class="form-control" required="" placeholder="Informe o valor do Lançamento">

                        <div class="text-center">
                            <input type="button" class="btn btn-success" id="btnInsert" value="Inserir">
                            <input type="button" class="btn btn-warning" id="btnUpdate" value="Alterar">
                            <input type="button" class="btn btn-danger" id="btnDelete" value="Remover">
                            <input type="button" class="btn btn-secondary" id="btnClear" value="Limpar">
                        </div>
                    </div>
                </div>
        </form>

        <div class="column2">
            <table id="grid-lancamentos" class="styled-table">
                <thead>
                    <tr>
                        
                        <th scope="col">ID</th>
                        <th scope="col">Conta</th>
                        <th scope="col">Lançamentos</th>
                        
                    </tr>
                </thead>
                <tbody id="table-lancamentos">
                    <tr>
                        <td scope="row">1</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
        </div>


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script src="js/appConta.js"></script>
        <script src="js/appLancamentos.js"></script>
        <script>
            function exibeLancamentos() {
                // Remove todas as linhas do corpo da tabela
                $("#table-lancamentos").html("");

                // Popula a tabela com os registros do banco de dados
                for (i = 0; i < dbLancamentos.data.length; i++) {
                    let lancamento = dbLancamentos.data[i];
                    $("#table-lancamentos").append(`<tr><td scope="row">${lancamento.id}</td>
                                                <td>${lancamento.conta}</td>
                                                <td>${lancamento.valor}</td>
                                            </tr>`);
                }
            }

            function ListaContas() {
                let opcoes = document.getElementById('inputContas');
                let atribuir = "";
                for (i = 0; i < dbContas.data.length; i++) {
                    atribuir += '<option value=' + dbContas.data[i].nome + '>' + dbContas.data[i].nome + '</option>'

                }
                opcoes.innerHTML = atribuir;
            }

            function selectsConta() {
                const select = document.querySelector('#inputContas');

                const indice = select.selectedIndex;
                const valor = select.value;
                const text = select.options[indice].text;

                console.log(text);
            }

            function init() {

                ListaContas();
                exibeLancamentos();
                // Adiciona funções para tratar os eventos 
                $("#btnInsert").click(function() {
                    // Verfica se o formulário está preenchido corretamente
                    if (!$('#form-lancamento')[0].checkValidity()) {
                        alert("Preencha o formulário corretamente.");
                        return;
                    }

                    let campoConta = $("#inputContas").val();
                    let campoValor = $("#inputValor").val();
                    //let campoLancamento = $("#inputLancamento").val();
                    let lancamento = {
                        conta: campoConta,
                        valor: campoValor
                    };

                    insertLancamento(lancamento);

                    // Reexibe os Lancamentos
                    exibeLancamentos();

                    // Limpa o formulario
                    $("#form-lancamento")[0].reset();
                });

                // Intercepta o click do botão Alterar
                $("#btnUpdate").click(function() {
                    // Obtem os valores dos campos do formulário
                    let campoId = $("#inputId").val();
                    if (campoId == "") {
                        alert("Selecione uma lancamento para ser alterada.");
                        return;
                    }
                    let campoConta = $("#inputContas").val();
                    let campoValor = $("#inputValor").val();
                    //let campoLancamento = $("#inputLancamento").val();
                    let lancamento = {
                        conta: campoConta,
                        valor: campoValor
                    };

                    updateLancamento(parseInt(campoId), lancamento);

                    // Reexibe os lancamentos
                    exibeLancamentos();

                    // Limpa o formulario
                    $("#form-lancamento")[0].reset();
                });

                // Intercepta o click do botão Excluir
                $("#btnDelete").click(function() {
                    let campoId = $("#inputId").val();
                    if (campoId == "") {
                        alert("Selecione um lançamento a ser excluído.");
                        return;
                    }
                    deleteLancamento(parseInt(campoId));

                    // Reexibe os lancamentos
                    exibeLancamentos();

                    // Limpa o formulario
                    $("#form-lancamento")[0].reset();
                });

                // Intercepta o click do botão Listar lancamentos
                $("#btnClear").click(function() {
                    $("#form-lancamento")[0].reset();
                });

                // Oculta a mensagem de aviso após alguns segundos
                $('#msg').bind("DOMSubtreeModified", function() {
                    window.setTimeout(function() {
                        $(".alert").fadeTo(500, 0).slideUp(500, function() {
                            $(this).remove();
                        });
                    }, 5000);
                });

                // Preenche o formulário quando o usuario clicar em uma linha da tabela 
                $("#grid-lancamentos").on("click", "tr", function(e) {
                    let linhaLancamento = this;
                    colunas = linhaLancamento.querySelectorAll("td");

                    $("#inputId").val(colunas[0].innerText);
                    $("#inputContas").val(colunas[1].innerText);
                    $("#inputValor").val(colunas[2].innerText);
                });

                exibeLancamentos();
            }
        </script>

        <footer>
            <p>FinanKids <a href="#"> LTDA</a></p>
                </footer>

    </body>

</html>